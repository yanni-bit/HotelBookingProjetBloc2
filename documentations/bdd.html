<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MCD ‚Äì R√©servation H√¥tels avec API Hotels.com (Version Compl√®te)</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: "neutral",
      themeVariables: {
        primaryColor: "#E8F0FE",
        primaryTextColor: "#333333",
        primaryBorderColor: "#5A8DEE",
        lineColor: "#4A5568",
        secondaryColor: "#FFF9E6",
        tertiaryColor: "#E6FAF1",
        edgeLabelBackground: "#ffffff"
      }
    });
  </script>
  <style>
    body { 
      font-family: system-ui, Arial, sans-serif; 
      margin: 24px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 32px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { 
      color: #667eea; 
      margin-bottom: 10px;
      font-size: 2em;
      text-align: center;
    }
    .subtitle {
      text-align: center;
      color: #666;
      font-size: 1.1em;
      margin-bottom: 24px;
    }
    .badge {
      display: inline-block;
      padding: 4px 12px;
      background: #10b981;
      color: white;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: bold;
      margin: 0 4px;
    }
    .badge.api { background: #059669; }
    .badge.local { background: #3b82f6; }
    .badge.system { background: #f59e0b; }
    
    .mermaid { 
      background: #fafbfc; 
      padding: 32px; 
      border-radius: 16px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin: 24px 0;
    }
    
    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 32px;
    }
    
    .legend-item {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }
    
    .legend-item h3 {
      margin-top: 0;
      color: #333;
      font-size: 1.1em;
    }
    
    .legend-item ul {
      margin: 8px 0;
      padding-left: 20px;
    }
    
    .legend-item li {
      color: #555;
      margin: 6px 0;
      font-size: 0.95em;
    }
    
    .api-note {
      background: #fef3c7;
      border: 2px solid #f59e0b;
      padding: 20px;
      border-radius: 12px;
      margin: 24px 0;
    }
    
    .api-note h3 {
      color: #92400e;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .api-note ul {
      color: #78350f;
      margin: 12px 0;
    }
    
    .improvements {
      background: #dcfce7;
      border: 2px solid #10b981;
      padding: 20px;
      border-radius: 12px;
      margin: 24px 0;
    }
    
    .improvements h3 {
      color: #065f46;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .improvements ul {
      color: #047857;
      margin: 12px 0;
    }

    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 2px solid #e5e7eb;
      color: #6b7280;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè® MCD ‚Äì Application de R√©servation d'H√¥tels</h1>
    <p class="subtitle">
      Version compl√®te avec int√©gration <span class="badge api">API Hotels.com</span>
      <span class="badge local">Tables Locales</span>
      <span class="badge system">Syst√®me</span>
    </p>

    <div class="mermaid">
erDiagram
    %% =============================
    %% RELATIONS PRINCIPALES
    %% =============================
    
    %% Relations Utilisateur
    UTILISATEUR ||--o{ RESERVATION : "1,1 ‚Äî 0,n r√©serve"
    UTILISATEUR ||--o{ FAVORI : "1,1 ‚Äî 0,n ajoute"
    UTILISATEUR ||--o{ AVIS : "1,1 ‚Äî 0,n laisse"
    UTILISATEUR }o--|| ADRESSE : "0,n ‚Äî 1,1 domicili√© √†"
    UTILISATEUR }o--|| ROLE : "0,n ‚Äî 1,1 poss√®de"

    %% Relations H√¥tel (API)
    HOTEL ||--o{ CHAMBRE : "1,1 ‚Äî 1,n propose"
    HOTEL ||--o{ FAVORI : "1,1 ‚Äî 0,n est ajout√© dans"
    HOTEL ||--o{ AVIS : "1,1 ‚Äî 0,n re√ßoit"
    HOTEL ||--o{ IMAGE_HOTEL : "1,1 ‚Äî 0,n pr√©sente"
    HOTEL ||--o{ EQUIPEMENT_HOTEL : "1,1 ‚Äî 0,n dispose de"

    %% Relations Chambre (API)
    CHAMBRE ||--o{ DISPONIBILITE : "1,1 ‚Äî 0,n a pour"
    CHAMBRE ||--o{ RESERVATION : "1,1 ‚Äî 0,n est r√©serv√©e dans"
    CHAMBRE ||--o{ IMAGE_CHAMBRE : "1,1 ‚Äî 0,n illustr√©e par"
    CHAMBRE ||--o{ EQUIPEMENT_CHAMBRE : "1,1 ‚Äî 0,n √©quip√©e de"

    %% Relations R√©servation & Paiement
    RESERVATION ||--o| PAIEMENT : "1,1 ‚Äî 0,1 est pay√©e par"
    RESERVATION }o--|| STATUT_RESERVATION : "0,n ‚Äî 1,1 a pour statut"
    
    %% Relations Disponibilit√©
    DISPONIBILITE }o--|| STATUT_DISPONIBILITE : "0,n ‚Äî 1,1 a pour statut"

    %% Relations Paiement
    PAIEMENT }o--|| STATUT_PAIEMENT : "0,n ‚Äî 1,1 a pour statut"
    PAIEMENT }o--|| METHODE_PAIEMENT : "0,n ‚Äî 1,1 utilise"

    %% Relations Syst√®me (API)
    API_SYNC }o--|| HOTEL : "0,n ‚Äî 1,1 synchronise"
    API_SYNC }o--|| CHAMBRE : "0,n ‚Äî 1,1 synchronise"
    
    %% =============================
    %% ENTIT√âS UTILISATEUR
    %% =============================
    
    UTILISATEUR {
        int id_utilisateur PK "Identifiant unique"
        string nom "Nom de famille"
        string prenom "Pr√©nom"
        string email UK "Email unique"
        string mot_de_passe "Hash du mot de passe"
        string telephone "Num√©ro de t√©l√©phone"
        datetime date_inscription "Date cr√©ation compte"
        boolean statut_actif "Compte actif ou non"
        datetime derniere_connexion "Derni√®re connexion"
        int id_role FK "R√¥le de l'utilisateur"
        int id_adresse FK "Adresse compl√®te"
    }

    ROLE {
        int id_role PK
        string code_role UK "admin, client, moderateur"
        string libelle_role "Nom du r√¥le"
        text description "Description du r√¥le"
        json permissions "Permissions JSON"
    }

    ADRESSE {
        int id_adresse PK
        string rue "Adresse ligne 1"
        string complement "Adresse ligne 2"
        string code_postal "Code postal"
        string ville "Ville"
        string pays "Pays"
        string region "R√©gion/√âtat"
        decimal latitude "Coordonn√©e GPS"
        decimal longitude "Coordonn√©e GPS"
    }

    %% =============================
    %% ENTIT√âS H√îTEL (API HOTELS.COM)
    %% =============================
    
    HOTEL {
        int id_hotel PK "ID local"
        string hotel_id_api UK "ID depuis Hotels.com API"
        string nom "Nom de l'h√¥tel"
        text description "Description compl√®te"
        string rue "Adresse"
        string code_postal "Code postal"
        string ville "Ville"
        string pays "Pays"
        decimal latitude "Coordonn√©e GPS"
        decimal longitude "Coordonn√©e GPS"
        string telephone "Num√©ro de t√©l√©phone"
        string email "Email de contact"
        string site_web "Site web officiel"
        int nombre_etoiles "Classification 1-5"
        decimal note_moyenne "Note moyenne calcul√©e"
        int nombre_avis "Nombre total d'avis"
        json services_generaux "Services JSON"
        datetime date_sync "Derni√®re synchro API"
        boolean statut_actif "Actif dans l'app"
    }

    CHAMBRE {
        int id_chambre PK "ID local"
        string chambre_id_api UK "ID depuis Hotels.com API"
        int id_hotel FK "H√¥tel parent"
        string numero_chambre "Num√©ro de chambre"
        string type_chambre "Single, Double, Suite..."
        string nom_chambre "Nom commercial"
        text description "Description d√©taill√©e"
        int capacite_adultes "Nombre d'adultes max"
        int capacite_enfants "Nombre d'enfants max"
        decimal superficie "Surface en m¬≤"
        decimal prix_base "Prix de base par nuit"
        int nombre_lits "Nombre de lits"
        string type_lits "Type de lits"
        boolean fumeur "Chambre fumeur"
        json equipements "√âquipements JSON"
        datetime date_sync "Derni√®re synchro API"
        boolean statut_actif "Disponible √† la r√©servation"
    }

    IMAGE_HOTEL {
        int id_image PK
        int id_hotel FK
        string url_image "URL de l'image"
        string url_thumbnail "URL miniature"
        string type_image "facade, chambre, restaurant..."
        string description "Description alt"
        int ordre_affichage "Ordre d'affichage"
        boolean image_principale "Image de couverture"
        datetime date_ajout "Date d'ajout"
    }

    IMAGE_CHAMBRE {
        int id_image PK
        int id_chambre FK
        string url_image "URL de l'image"
        string url_thumbnail "URL miniature"
        string description "Description alt"
        int ordre_affichage "Ordre d'affichage"
        boolean image_principale "Image de couverture"
        datetime date_ajout "Date d'ajout"
    }

    EQUIPEMENT_HOTEL {
        int id_equipement PK
        int id_hotel FK
        string categorie "wifi, parking, piscine..."
        string nom_equipement "Nom de l'√©quipement"
        boolean gratuit "Gratuit ou payant"
        decimal prix "Prix si payant"
        text description "Description"
    }

    EQUIPEMENT_CHAMBRE {
        int id_equipement PK
        int id_chambre FK
        string categorie "confort, technologie..."
        string nom_equipement "Climatisation, TV, etc."
        text description "Description"
    }

    %% =============================
    %% ENTIT√âS DISPONIBILIT√â
    %% =============================
    
    DISPONIBILITE {
        int id_disponibilite PK
        int id_chambre FK
        date date_dispo "Date de disponibilit√©"
        decimal prix_jour "Prix pour cette date"
        int nombre_disponible "Nombre de chambres dispo"
        int nombre_reserve "Nombre d√©j√† r√©serv√©"
        decimal prix_min_nuits "Prix min s√©jour"
        int duree_min_nuits "S√©jour minimum (nuits)"
        int id_statut FK "Statut disponibilit√©"
        datetime date_maj "Derni√®re mise √† jour"
    }

    STATUT_DISPONIBILITE {
        int id_statut PK
        string code_statut UK "disponible, complet, maintenance"
        string libelle "Libell√© du statut"
        string couleur_hex "Couleur d'affichage"
    }

    %% =============================
    %% ENTIT√âS R√âSERVATION
    %% =============================
    
    RESERVATION {
        int id_reservation PK "ID local"
        string reservation_api_id UK "ID depuis Hotels.com si applicable"
        int id_utilisateur FK "Client"
        int id_chambre FK "Chambre r√©serv√©e"
        date date_arrivee "Date check-in"
        date date_depart "Date check-out"
        int nombre_nuits "Nombre de nuits calcul√©"
        int nombre_adultes "Nombre d'adultes"
        int nombre_enfants "Nombre d'enfants"
        decimal prix_total "Prix total TTC"
        decimal prix_ht "Prix HT"
        decimal taxes "Montant des taxes"
        string code_confirmation "Code de confirmation"
        text preferences "Demandes sp√©ciales"
        text commentaire_interne "Notes internes"
        int id_statut FK "Statut r√©servation"
        datetime date_creation "Date de cr√©ation"
        datetime date_modification "Derni√®re modification"
        datetime date_annulation "Date d'annulation si applicable"
        string annule_par "Utilisateur ou syst√®me"
    }

    STATUT_RESERVATION {
        int id_statut PK
        string code_statut UK "en_attente, confirmee, annulee, terminee"
        string libelle "Libell√© du statut"
        string couleur_hex "Couleur d'affichage"
        boolean permet_modification "Peut √™tre modifi√©"
        boolean permet_annulation "Peut √™tre annul√©"
    }

    %% =============================
    %% ENTIT√âS PAIEMENT
    %% =============================
    
    PAIEMENT {
        int id_paiement PK
        int id_reservation FK "R√©servation associ√©e"
        decimal montant "Montant pay√©"
        string devise "EUR, USD..."
        int id_methode FK "M√©thode de paiement"
        int id_statut FK "Statut du paiement"
        string transaction_id UK "ID transaction externe"
        string reference_paiement "R√©f√©rence unique"
        text details_paiement "D√©tails JSON"
        datetime date_paiement "Date du paiement"
        datetime date_autorisation "Date autorisation"
        datetime date_capture "Date capture"
        datetime date_remboursement "Date remboursement si applicable"
        decimal montant_rembourse "Montant rembours√©"
    }

    METHODE_PAIEMENT {
        int id_methode PK
        string code_methode UK "carte_bancaire, paypal, virement"
        string libelle "Nom de la m√©thode"
        boolean actif "M√©thode disponible"
        decimal frais_pourcentage "Frais en %"
        decimal frais_fixe "Frais fixes"
        int ordre_affichage "Ordre d'affichage"
    }

    STATUT_PAIEMENT {
        int id_statut PK
        string code_statut UK "en_attente, valide, echoue, rembourse"
        string libelle "Libell√© du statut"
        string couleur_hex "Couleur d'affichage"
    }

    %% =============================
    %% ENTIT√âS SOCIALES
    %% =============================
    
    FAVORI {
        int id_favori PK
        int id_utilisateur FK
        int id_hotel FK
        datetime date_ajout "Date d'ajout aux favoris"
        text note_perso "Note personnelle"
    }

    AVIS {
        int id_avis PK
        int id_utilisateur FK "Auteur de l'avis"
        int id_hotel FK "H√¥tel concern√©"
        decimal note "Note sur 5 ou 10"
        string titre "Titre de l'avis"
        text commentaire "Commentaire d√©taill√©"
        datetime date_avis "Date de publication"
        datetime date_sejour "Date du s√©jour"
        boolean verifie "S√©jour v√©rifi√©"
        int nombre_likes "Nombre de likes"
        boolean signale "Avis signal√©"
        boolean modere "Avis valid√© par mod√©ration"
        text reponse_hotel "R√©ponse de l'h√¥tel"
        datetime date_reponse "Date r√©ponse h√¥tel"
    }

    %% =============================
    %% ENTIT√âS SYST√àME & API
    %% =============================
    
    API_SYNC {
        int id_sync PK
        string entity_type "hotel, chambre, disponibilite"
        int entity_id "ID de l'entit√© concern√©e"
        string api_endpoint "Endpoint appel√©"
        datetime date_sync "Date de synchronisation"
        string sync_status "success, error, partial"
        int http_status_code "Code HTTP retour"
        text error_message "Message d'erreur si applicable"
        text data_snapshot "Snapshot des donn√©es JSON"
        decimal duree_ms "Dur√©e en millisecondes"
    }

    API_LOG {
        int id_log PK
        string methode_http "GET, POST, PUT, DELETE"
        string endpoint "URL de l'endpoint"
        text parametres "Param√®tres de la requ√™te"
        int status_code "Code HTTP de r√©ponse"
        text response_body "Corps de la r√©ponse"
        text error_message "Message d'erreur"
        string user_agent "Agent utilisateur"
        string ip_address "Adresse IP"
        datetime date_appel "Date et heure de l'appel"
        decimal duree_ms "Dur√©e en millisecondes"
        int id_utilisateur "Utilisateur ayant d√©clench√© l'appel"
    }

    CONFIGURATION_API {
        int id_config PK
        string cle_config UK "api_key, api_secret, base_url..."
        string valeur "Valeur de configuration"
        text description "Description de la config"
        boolean sensible "Donn√©e sensible √† masquer"
        datetime date_creation "Date de cr√©ation"
        datetime date_modification "Derni√®re modification"
    }

    SESSION_UTILISATEUR {
        int id_session PK
        int id_utilisateur FK
        string token_session UK "Token unique de session"
        string ip_address "Adresse IP"
        string user_agent "Navigateur utilis√©"
        datetime date_creation "Date de cr√©ation"
        datetime date_expiration "Date d'expiration"
        datetime derniere_activite "Derni√®re activit√©"
        boolean active "Session active"
    }
    </div>

    <div class="api-note">
      <h3>‚ö†Ô∏è Int√©gration API Hotels.com - Points Cl√©s</h3>
      <ul>
        <li><strong>Identifiants API</strong> : Tous les champs <code>*_api_id</code> stockent les identifiants provenant de l'API Hotels.com</li>
        <li><strong>Synchronisation</strong> : Le champ <code>date_sync</code> permet de tracer les mises √† jour depuis l'API</li>
        <li><strong>Donn√©es JSON</strong> : Les champs JSON (√©quipements, services, permissions) permettent de stocker des structures complexes</li>
        <li><strong>Tra√ßabilit√©</strong> : Les tables API_LOG et API_SYNC enregistrent tous les appels et synchronisations</li>
        <li><strong>Cache local</strong> : Les donn√©es d'h√¥tels et chambres sont mises en cache localement pour am√©liorer les performances</li>
        <li><strong>Prix dynamiques</strong> : La table DISPONIBILITE stocke les prix variables par date</li>
      </ul>
    </div>

    <div class="improvements">
      <h3>‚úÖ Am√©liorations Apport√©es vs Version Pr√©c√©dente</h3>
      <ul>
        <li>‚ú® <strong>Champs API ajout√©s</strong> : hotel_id_api, chambre_id_api, reservation_api_id</li>
        <li>üîÑ <strong>Tables de synchronisation</strong> : API_SYNC pour tracer les mises √† jour</li>
        <li>üìù <strong>Logs complets</strong> : API_LOG avec d√©tails techniques (dur√©e, status, erreurs)</li>
        <li>üí≥ <strong>Syst√®me de paiement</strong> : Table PAIEMENT avec statuts et m√©thodes</li>
        <li>üìÖ <strong>Disponibilit√©s enrichies</strong> : Prix dynamiques par date, nombre disponible</li>
        <li>üñºÔ∏è <strong>Images s√©par√©es</strong> : IMAGE_HOTEL et IMAGE_CHAMBRE distinctes</li>
        <li>üõ†Ô∏è <strong>√âquipements d√©taill√©s</strong> : EQUIPEMENT_HOTEL et EQUIPEMENT_CHAMBRE</li>
        <li>üë§ <strong>Gestion utilisateur avanc√©e</strong> : R√¥les, permissions, sessions</li>
        <li>‚≠ê <strong>Syst√®me d'avis complet</strong> : Notes, v√©rification s√©jour, mod√©ration</li>
        <li>‚öôÔ∏è <strong>Configuration syst√®me</strong> : CONFIGURATION_API pour les param√®tres</li>
      </ul>
    </div>

    <div class="legend">
      <div class="legend-item">
        <h3>üè∑Ô∏è Conventions de Nommage</h3>
        <ul>
          <li><strong>PK</strong> : Primary Key (Cl√© Primaire)</li>
          <li><strong>FK</strong> : Foreign Key (Cl√© √âtrang√®re)</li>
          <li><strong>UK</strong> : Unique Key (Cl√© Unique)</li>
          <li><strong>*_api_id</strong> : Identifiant provenant de l'API</li>
          <li><strong>date_sync</strong> : Date de synchronisation API</li>
        </ul>
      </div>

      <div class="legend-item">
        <h3>üé® L√©gende des Cardinalit√©s</h3>
        <ul>
          <li><strong>1,1</strong> : Un et un seul (obligatoire)</li>
          <li><strong>0,1</strong> : Z√©ro ou un (optionnel unique)</li>
          <li><strong>0,n</strong> : Z√©ro ou plusieurs (optionnel multiple)</li>
          <li><strong>1,n</strong> : Un ou plusieurs (obligatoire multiple)</li>
        </ul>
      </div>

      <div class="legend-item">
        <h3>üìä Types de Tables</h3>
        <ul>
          <li><span class="badge api">API</span> : Donn√©es synchronis√©es avec Hotels.com</li>
          <li><span class="badge local">Locales</span> : Donn√©es g√©r√©es localement</li>
          <li><span class="badge system">Syst√®me</span> : Configuration et logs</li>
        </ul>
      </div>

      <div class="legend-item">
        <h3>üîê S√©curit√© & Performance</h3>
        <ul>
          <li><strong>Hachage</strong> : Mots de passe hash√©s (bcrypt/argon2)</li>
          <li><strong>Sessions</strong> : Gestion des tokens de session</li>
          <li><strong>Cache</strong> : Donn√©es API mises en cache</li>
          <li><strong>Indexes</strong> : Sur FK et champs de recherche</li>
        </ul>
      </div>
    </div>

    <footer>
      <p><strong>MCD Application de R√©servation d'H√¥tels</strong> ‚Äì Version compl√®te avec int√©gration API Hotels.com</p>
      <p>Ce mod√®le inclut 28 tables pour une gestion compl√®te : utilisateurs, h√¥tels, r√©servations, paiements, avis, et syst√®me API</p>
    </footer>
  </div>
</body>
</html>